- name: Deploy React + PHP App
  uses: appleboy/ssh-action@v1.0.3
  with:
    host: ${{ secrets.EC2_HOST }}
    username: ${{ secrets.EC2_USER }}
    key: ${{ secrets.EC2_SSH_KEY }}
    script_stop: true
    script: |
      # Deploy React build
      sudo rm -rf /var/www/react-app/public/*
      sudo cp -r /var/www/react-app/frontend/dist/* /var/www/react-app/public/
      sudo chown -R www-data:www-data /var/www/react-app/public
      sudo chmod -R 755 /var/www/react-app/public
      sudo systemctl reload nginx

      # PHP dependencies (optional)
      if [ -f /var/www/react-app/backend/composer.json ]; then
        cd /var/www/react-app/backend
        composer install --no-dev --optimize-autoloader
      fi
